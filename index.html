<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Altitude â€” GM Sock Ordering</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      color-scheme: light dark;

      --bg: #f5f5f7;
      --card-bg: #ffffff;
      --accent: #007aff;
      --accent-soft: rgba(0, 122, 255, 0.08);
      --border-subtle: rgba(0, 0, 0, 0.06);
      --border-strong: rgba(148, 163, 184, 0.6);
      --text-main: #111827;
      --text-muted: #6b7280;
      --radius-lg: 22px;
      --radius-md: 12px;
      --shadow-soft: 0 22px 45px rgba(15, 23, 42, 0.18);
      --shadow-tiny: 0 1px 3px rgba(15, 23, 42, 0.08);
    }

    * {
      box-sizing: border-box;
      -webkit-font-smoothing: antialiased;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        "Segoe UI", sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 18px;
      background: radial-gradient(circle at top, #e5e7eb 0, #f5f5f7 60%);
      color: var(--text-main);
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      margin: auto;
      background: var(--card-bg);
      border-radius: 28px;
      border: 1px solid var(--border-subtle);
      box-shadow: var(--shadow-soft);
      padding: 20px 22px 22px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    /* HEADER */

    header.app-header {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: space-between;
      align-items: center;
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .title-block h1 {
      font-size: 1.6rem;
      font-weight: 650;
      margin: 0;
      letter-spacing: 0.02em;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .title-pill {
      font-size: 0.72rem;
      padding: 3px 10px;
      border-radius: 999px;
      background: var(--accent-soft);
      border: 1px solid rgba(0, 122, 255, 0.45);
      color: var(--accent);
      text-transform: uppercase;
      letter-spacing: 0.12em;
    }

    .title-sub {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: flex-end;
    }

    .field-group {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.8rem;
    }

    label {
      color: var(--text-muted);
      font-size: 0.78rem;
    }

    select,
    button {
      font: inherit;
    }

    select {
      background: #f9fafb;
      color: var(--text-main);
      border-radius: 999px;
      padding: 6px 12px;
      border: 1px solid var(--border-strong);
      min-width: 210px;
      outline: none;
      font-size: 0.9rem;
      appearance: none;
      background-image:
        linear-gradient(45deg, transparent 50%, #9ca3af 50%),
        linear-gradient(135deg, #9ca3af 50%, transparent 50%);
      background-position:
        calc(100% - 16px) calc(50% - 3px),
        calc(100% - 11px) calc(50% - 3px);
      background-size:
        6px 6px,
        6px 6px;
      background-repeat: no-repeat;
    }

    select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0, 122, 255, 0.3);
      background-color: #ffffff;
    }

    .pill-info {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .pill-info strong {
      color: var(--accent);
    }

    button {
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      background: #111827;
      color: #f9fafb;
      padding: 7px 14px;
      cursor: pointer;
      font-size: 0.85rem;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.25);
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background 0.1s ease, border-color 0.1s ease;
    }

    button:hover {
      background: #020617;
      border-color: #020617;
      box-shadow: 0 10px 22px rgba(15, 23, 42, 0.35);
      transform: translateY(-0.5px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 4px 10px rgba(15, 23, 42, 0.28);
    }

    button.secondary {
      background: #f9fafb;
      color: var(--text-main);
      border-style: dashed;
      box-shadow: none;
    }

    button.secondary:hover {
      background: #ffffff;
      border-style: solid;
    }

    /* LAYOUT */

    main {
      display: grid;
      grid-template-columns: minmax(0, 2.1fr) minmax(0, 1.3fr);
      gap: 16px;
      align-items: flex-start;
    }

    @media (max-width: 980px) {
      main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    /* CARDS */

    .card {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-subtle);
      padding: 14px 14px 16px;
      box-shadow: var(--shadow-soft);
      position: relative;
    }

    .card-inner {
      position: relative;
      z-index: 1;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 12px;
    }

    .card-title {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-muted);
    }

    .card-subtitle {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-top: 2px;
    }

    .badge-soft {
      padding: 4px 10px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid var(--border-strong);
      font-size: 0.8rem;
      color: var(--text-muted);
      box-shadow: var(--shadow-tiny);
    }

    .badge-soft strong {
      color: var(--accent);
    }

    /* TABLE */

    .table-wrapper {
      border-radius: 18px;
      border: 1px solid rgba(229, 231, 235, 0.9);
      background: #f9fafb;
      overflow: auto;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 720px;
      font-size: 0.78rem;
    }

    thead {
      background: #f3f4f6;
      box-shadow: 0 1px 0 rgba(229, 231, 235, 0.9);
    }

    th,
    td {
      padding: 6px 8px;
      border-bottom: 1px solid rgba(229, 231, 235, 0.9);
      text-align: center;
      white-space: nowrap;
    }

    th {
      font-weight: 500;
      color: var(--text-muted);
    }

    th:first-child,
    td:first-child {
      text-align: left;
    }

    th.style-col {
      min-width: 130px;
    }

    th.size-col,
    td.size-col {
      min-width: 70px;
    }

    th.total-col,
    td.total-col {
      min-width: 80px;
    }

    td.style-name {
      font-weight: 500;
      color: var(--text-main);
    }

    td.image-cell {
      position: relative;
      padding: 6px;
      min-width: 80px;
    }

    td.image-cell img {
      width: 48px;
      height: 48px;
      object-fit: cover;
      border-radius: 14px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      display: block;
      margin: 0 auto;
      box-shadow: var(--shadow-tiny);
    }

    td.image-cell small {
      display: block;
      margin-top: 3px;
      font-size: 0.65rem;
      color: var(--text-muted);
    }

    input[type="number"] {
      width: 56px;
      padding: 3px 4px;
      border-radius: 999px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: #ffffff;
      color: var(--text-main);
      text-align: center;
      font-size: 0.78rem;
      outline: none;
    }

    input[type="number"]:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0, 122, 255, 0.3);
    }

    td.disabled {
      opacity: 0.22;
      font-size: 0.65rem;
    }

    td.style-total {
      font-weight: 600;
      color: var(--text-main);
    }

    tr:nth-child(even) td {
      background: #f9fafb;
    }

    tr:hover td {
      background: #e5f2ff;
    }

    /* SUMMARY SIDE */

    .summary-grid {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .summary-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      justify-content: space-between;
    }

    .summary-kpis {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .kpi {
      padding: 6px 10px;
      border-radius: 999px;
      background: #f9fafb;
      border: 1px solid var(--border-strong);
      font-size: 0.8rem;
      display: inline-flex;
      gap: 6px;
      align-items: baseline;
    }

    .kpi span.label {
      color: var(--text-muted);
    }

    .kpi span.value {
      font-weight: 600;
      color: var(--accent);
    }

    .order-text-wrap {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    textarea {
      width: 100%;
      min-height: 180px;
      resize: vertical;
      border-radius: 16px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      background: #f9fafb;
      color: var(--text-main);
      font-size: 0.78rem;
      padding: 10px;
      font-family: ui-monospace, Menlo, Monaco, "SF Mono", Consolas,
        "Liberation Mono", "Courier New", monospace;
      outline: none;
    }

    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(0, 122, 255, 0.3);
      background: #ffffff;
    }

    .order-helper {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .order-helper code {
      font-family: ui-monospace, Menlo, Monaco, "SF Mono", Consolas,
        "Liberation Mono", "Courier New", monospace;
      font-size: 0.7rem;
      background: #eef2ff;
      padding: 1px 4px;
      border-radius: 6px;
      border: 1px solid rgba(199, 210, 254, 0.9);
    }

    .copy-status {
      font-size: 0.78rem;
      color: var(--accent);
      min-height: 1em;
    }

    /* RESPONSIVE TWEAKS */

    @media (max-width: 700px) {
      body {
        padding: 12px;
      }
      .app-shell {
        padding: 14px 14px 16px;
        border-radius: 18px;
      }
      header.app-header {
        align-items: flex-start;
      }
    }

    /* DARK MODE */

    @media (prefers-color-scheme: dark) {
      body {
        background: radial-gradient(circle at top, #111827 0, #020617 60%);
        color: #e5e7eb;
      }

      .app-shell {
        background: #020617;
        border-color: rgba(31, 41, 55, 0.9);
      }

      .title-sub,
      .pill-info,
      .card-subtitle,
      .order-helper,
      .copy-status {
        color: #9ca3af;
      }

      select {
        background: rgba(15, 23, 42, 0.96);
        border-color: rgba(55, 65, 81, 0.9);
        color: #e5e7eb;
      }

      button.secondary {
        background: rgba(15, 23, 42, 0.96);
        color: #e5e7eb;
        border-color: rgba(75, 85, 99, 0.9);
      }

      .card {
        background: #020617;
        border-color: rgba(31, 41, 55, 0.9);
      }

      .badge-soft {
        background: rgba(15, 23, 42, 0.96);
        border-color: rgba(55, 65, 81, 0.9);
        color: #e5e7eb;
      }

      .table-wrapper {
        background: rgba(15, 23, 42, 0.96);
        border-color: rgba(55, 65, 81, 0.9);
      }

      thead {
        background: rgba(31, 41, 55, 0.95);
        box-shadow: 0 1px 0 rgba(55, 65, 81, 0.9);
      }

      th,
      td {
        border-bottom-color: rgba(55, 65, 81, 0.9);
      }

      td.style-name {
        color: #e5e7eb;
      }

      td.image-cell img {
        border-color: rgba(75, 85, 99, 0.9);
      }

      tr:nth-child(even) td {
        background: rgba(15, 23, 42, 0.96);
      }

      tr:hover td {
        background: rgba(37, 99, 235, 0.32);
      }

      input[type="number"] {
        background: rgba(15, 23, 42, 0.98);
        border-color: rgba(55, 65, 81, 0.9);
        color: #e5e7eb;
      }

      .kpi {
        background: rgba(15, 23, 42, 0.96);
        border-color: rgba(55, 65, 81, 0.9);
      }

      textarea {
        background: rgba(15, 23, 42, 0.98);
        border-color: rgba(55, 65, 81, 0.9);
        color: #e5e7eb;
      }

      .order-helper code {
        background: rgba(15, 23, 42, 0.96);
        border-color: rgba(55, 65, 81, 0.9);
        color: #e5e7eb;
      }
    }
  </style>
</head>
<body>
  <div class="app-shell">
    <header class="app-header">
      <div class="title-block">
        <h1>
          Altitude Socks
          <span class="title-pill">GM Ordering Sheet</span>
        </h1>
        <div class="title-sub">
          Type your pairs by size. Weâ€™ll total everything and format an order
          you can paste into email or your vendor portal.
        </div>
      </div>

      <div class="controls">
        <div class="field-group">
          <label for="parkSelect">Park location</label>
          <select id="parkSelect">
            <option value="">Select your parkâ€¦</option>
          </select>
          <div class="pill-info" id="availabilityStamp"></div>
        </div>

        <div class="field-group">
          <label>&nbsp;</label>
          <button id="clearAllBtn" class="secondary" type="button">
            âŸ² Clear all quantities
          </button>
        </div>
      </div>
    </header>

    <main>
      <!-- LEFT: TABLE -->
      <section class="card">
        <div class="card-inner">
          <div class="card-header">
            <div>
              <div class="card-title">Sock Styles & Sizes</div>
              <div class="card-subtitle">
                Only available sizes are editable. Totals update automatically as you type.
              </div>
            </div>
            <div class="badge-soft">
              <span id="availabilityNote">Live catalog</span>
            </div>
          </div>

          <div class="table-wrapper">
            <table id="sockTable">
              <thead>
                <tr id="tableHeaderRow"></tr>
              </thead>
              <tbody id="tableBody"></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- RIGHT: SUMMARY / ORDER TEXT -->
      <section class="card">
        <div class="card-inner">
          <div class="card-header">
            <div>
              <div class="card-title">Order Summary</div>
              <div class="card-subtitle">
                Weâ€™ll format this for you with case packs and totals.
              </div>
            </div>
            <div class="badge-soft">
              <span>Pairs & styles</span>
            </div>
          </div>

          <div class="summary-grid">
            <div class="summary-row">
              <div class="summary-kpis">
                <div class="kpi">
                  <span class="label">Total pairs</span>
                  <span class="value" id="totalPairs">0</span>
                </div>
                <div class="kpi">
                  <span class="label">Styles with qty &gt; 0</span>
                  <span class="value" id="stylesWithQty">0</span>
                </div>
              </div>
            </div>

            <div class="order-text-wrap">
             
              <textarea id="orderText" spellcheck="false"></textarea>
              <div class="summary-row">
                <button id="copyBtn" type="button">ðŸ“‹ Copy order text</button>
                <div class="copy-status" id="copyStatus"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script>
    // -----------------------------
    // 1. DATA (from your /data folder)
    // -----------------------------

    const CATALOG = {
      "parks": [
        {"id": "appleton","name": "Altitude Appleton","city": "Appleton","state": "WI"},
        {"id": "gastonia","name": "Altitude Gastonia","city": "Gastonia","state": "NC"},
        {"id": "lombard","name": "Altitude Lombard","city": "Lombard","state": "IL"},
        {"id": "pueblo","name": "Altitude Pueblo","city": "Pueblo","state": "CO"},
        {"id": "sanjose","name": "Altitude San Jose","city": "San Jose","state": "CA"},
        {"id": "york","name": "Altitude York","city": "York","state": "PA"}
      ],
      "styles": [
        {
          "id": "sapphire",
          "name": "Sapphire",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0000_033.jpg?v=1740230889&width=1000"
        },
        {
          "id": "bliss",
          "name": "Bliss",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0000_117.jpg?v=1740231869&width=1000"
        },
        {
          "id": "onyx",
          "name": "Onyx",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0000_084.jpg?v=1740231473&width=1000"
        },
        {
          "id": "blaze",
          "name": "Blaze",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0002_023.jpg?v=1740418912&width=1000"
        },
        {
          "id": "pulse",
          "name": "Pulse",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0005_026.jpg?v=1738887376&width=1000"
        },
        {
          "id": "leopard",
          "name": "Leopard",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0002_053.jpg?v=1740419303&width=1000"
        },
        {
          "id": "tiger",
          "name": "Tiger",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0002_062.jpg?v=1740419437&width=1000"
        },
        {
          "id": "blueblack",
          "name": "Blue-Black",
          "sizes": ["I","T","S","M","L","XL","XXL"],
          "image": "https://alma-fit.com/cdn/shop/files/0002_064.jpg?v=1740419450&width=1000"
        },
        {
          "id": "skyblue",
          "name": "Skyblue",
          "sizes": ["T","S"],
          "image": "https://alma-fit.com/cdn/shop/files/interim.jpg?v=1755198492&width=1000"
        },
        {
          "id": "purple",
          "name": "Purple",
          "sizes": ["M"],
          "image": "https://alma-fit.com/cdn/shop/files/interim2.jpg?v=1756283501&width=1000"
        },
        {
          "id": "partybag",
          "name": "Party Bag (100 Pair)",
          "sizes": ["ONESIZE"],
          "image": "https://images.squarespace-cdn.com/content/v1/5be61f6afcf7fddb2164ae62/1542166831529-KYJW2GPJP999AIGDAESZ/image-asset.jpeg?format=1000w"
        }
      ],
      "casePacks": [
        {
          "id": "defaultMain",
          "packs": {"I": 200,"T": 200,"S": 200,"M": 200,"L": 200,"XL": 200,"XXL": 200}
        },
        {
          "id": "sapphire",
          "packs": {"I": 200,"T": 200,"S": 200,"M": 200,"L": 200,"XL": 200,"XXL": 200}
        },
        {
          "id": "leopard",
          "packs": {"T": 300,"S": 300,"M": 300,"L": 300,"XL": 300}
        },
        {
          "id": "tiger",
          "packs": {"T": 300,"S": 300,"M": 300,"L": 300,"XL": 300}
        },
        {
          "id": "blueblack",
          "packs": {"I": 300,"T": 300,"S": 300,"M": 300,"L": 300,"XL": 300,"XXL": 300}
        },
        {
          "id": "skyblue",
          "packs": {"T": 300,"S": 300}
        },
        {
          "id": "purple",
          "packs": {"M": 300}
        },
        {
          "id": "partybag",
          "packs": {"ONESIZE": 100}
        }
      ],
      "defaultCasePacks": {
        "sapphire": "defaultMain",
        "bliss": "defaultMain",
        "onyx": "defaultMain",
        "blaze": "defaultMain",
        "pulse": "defaultMain",
        "leopard": "leopard",
        "tiger": "defaultMain",
        "blueblack": "defaultMain",
        "skyblue": {"T": 300,"S": 300},
        "purple": {"M": 300},
        "partybag": {"ONESIZE": 100}
      }
    };

    const AVAILABILITY = {
      "updatedAt": "2025-12-04T00:00:00Z",
      "styles": {
        "sapphire": { "I": true, "T": true, "S": true, "M": true, "L": true, "XL": false, "XXL": false },
        "bliss":    { "I": true, "T": true, "S": true, "M": true, "L": true, "XL": false, "XXL": false },
        "onyx":     { "I": true, "T": true, "S": false, "M": true, "L": true, "XL": false, "XXL": false },
        "blaze":    { "I": false,"T": false, "S": false,"M": true, "L": true, "XL": false, "XXL": false },
        "pulse":    { "I": false, "T": true, "S": false,"M": false,"L": true, "XL": false, "XXL": false },
        "leopard":  { "I": false,"T": true, "S": false,"M": true, "L": true, "XL": true,  "XXL": false },
        "tiger":    { "I": false,"T": false,"S": false,"M": true, "L": true, "XL": true,  "XXL": false },
        "blueblack":{ "I": false,"T": false,"S": false,"M": false,"L": false,"XL": false, "XXL": false },
        "skyblue":  { "T": true, "S": true },
        "purple":   { "M": false },
        "partybag": { "ONESIZE": true }
      }
    };

    const SIZE_ORDER = ["I", "T", "S", "M", "L", "XL", "XXL", "ONESIZE"];

    const STYLE_MAP = {};
    CATALOG.styles.forEach(s => { STYLE_MAP[s.id] = s; });

    const CASE_PACK_MAP = {};
    CATALOG.casePacks.forEach(cp => { CASE_PACK_MAP[cp.id] = cp; });

    const PARK_MAP = {};
    CATALOG.parks.forEach(p => { PARK_MAP[p.id] = p; });

    // -----------------------------
    // 2. DOM HOOKS
    // -----------------------------
    const parkSelect = document.getElementById("parkSelect");
    const tableHeaderRow = document.getElementById("tableHeaderRow");
    const tableBody = document.getElementById("tableBody");
    const totalPairsEl = document.getElementById("totalPairs");
    const stylesWithQtyEl = document.getElementById("stylesWithQty");
    const orderTextEl = document.getElementById("orderText");
    const copyBtn = document.getElementById("copyBtn");
    const copyStatusEl = document.getElementById("copyStatus");
    const clearAllBtn = document.getElementById("clearAllBtn");
    const availabilityStamp = document.getElementById("availabilityStamp");
    const availabilityNote = document.getElementById("availabilityNote");

    // -----------------------------
    // 3. INIT
    // -----------------------------

    function initApp() {
      initParkSelect();
      initTableHeader();
      buildTableBody();
      updateAvailabilityStamp();
      attachEvents();
      updateOrderSummary();
    }

    function initParkSelect() {
      CATALOG.parks.forEach(park => {
        const opt = document.createElement("option");
        opt.value = park.id;
        opt.textContent = `${park.name} (${park.city}, ${park.state})`;
        parkSelect.appendChild(opt);
      });
    }

    function initTableHeader() {
      const sizes = SIZE_ORDER;
      const headerCells = [];

      // First col: style
      headerCells.push(`<th class="style-col">Style</th>`);
      headerCells.push(`<th class="size-col">Preview</th>`);

      sizes.forEach(sizeCode => {
        let label = sizeCode;
        if (sizeCode === "I") label = "I (Infant)";
        if (sizeCode === "T") label = "T (Toddler)";
        if (sizeCode === "S") label = "S (Small)";
        if (sizeCode === "M") label = "M (Medium)";
        if (sizeCode === "L") label = "L (Large)";
        if (sizeCode === "XL") label = "XL";
        if (sizeCode === "XXL") label = "XXL";
        if (sizeCode === "ONESIZE") label = "One Size";

        headerCells.push(`<th class="size-col">${label}</th>`);
      });

      headerCells.push(`<th class="total-col">Total Style</th>`);

      tableHeaderRow.innerHTML = headerCells.join("");
    }

    function buildTableBody() {
      tableBody.textContent = ""; // clear

      CATALOG.styles.forEach(style => {
        const row = document.createElement("tr");
        row.dataset.styleId = style.id;

        const nameTd = document.createElement("td");
        nameTd.className = "style-name";
        nameTd.textContent = style.name;
        row.appendChild(nameTd);

        // Image
        const imgTd = document.createElement("td");
        imgTd.className = "image-cell";
        if (style.image) {
          const img = document.createElement("img");
          img.src = style.image;
          img.alt = style.name;
          img.loading = "lazy";
          imgTd.appendChild(img);
          const sm = document.createElement("small");
          sm.textContent = style.id;
          imgTd.appendChild(sm);
        } else {
          imgTd.textContent = "â€”";
        }
        row.appendChild(imgTd);

        const availStyles = (AVAILABILITY && AVAILABILITY.styles) || {};
        const styleAvail = availStyles[style.id] || {};

        SIZE_ORDER.forEach(sizeCode => {
          const td = document.createElement("td");
          td.classList.add("size-col");

          const allowedInCatalog = style.sizes.indexOf(sizeCode) !== -1;
          const isAvailable = !!styleAvail[sizeCode];

          if (allowedInCatalog && isAvailable) {
            const input = document.createElement("input");
            input.type = "number";
            input.min = "0";
            input.step = "1";
            input.value = "0";
            input.dataset.styleId = style.id;
            input.dataset.sizeCode = sizeCode;
            input.addEventListener("input", handleQtyChange);
            td.appendChild(input);
          } else if (allowedInCatalog && !isAvailable) {
            td.classList.add("disabled");
            td.textContent = "OOS";
          } else {
            td.classList.add("disabled");
            td.textContent = "â€”";
          }

          row.appendChild(td);
        });

        const totalTd = document.createElement("td");
        totalTd.className = "style-total total-col";
        totalTd.textContent = "0";
        row.appendChild(totalTd);

        tableBody.appendChild(row);
      });
    }

    function updateAvailabilityStamp() {
      if (!AVAILABILITY || !AVAILABILITY.updatedAt) {
        availabilityStamp.textContent = "Availability: unknown";
        availabilityNote.textContent = "Live catalog";
        return;
      }

      const d = new Date(AVAILABILITY.updatedAt);
      const formatted = d.toLocaleString(undefined, {
        month: "short",
        day: "numeric",
        year: "numeric"
      });

      availabilityStamp.textContent = `Availability as of ${formatted}`;
      availabilityNote.textContent = "Availability applied";
    }

    function attachEvents() {
      copyBtn.addEventListener("click", handleCopy);
      clearAllBtn.addEventListener("click", handleClearAll);
      parkSelect.addEventListener("change", updateOrderSummary);
    }

    // -----------------------------
    // 4. CASE PACK HELPERS
    // -----------------------------
    function getCasePack(styleId, size) {
      const defaultEntry = CATALOG.defaultCasePacks[styleId];

      let specificPack = null;
      if (defaultEntry && typeof defaultEntry === "string") {
        const cp = CASE_PACK_MAP[defaultEntry];
        if (cp && cp.packs[size]) {
          specificPack = cp.packs[size];
        }
      } else if (defaultEntry && typeof defaultEntry === "object") {
        if (defaultEntry[size]) {
          specificPack = defaultEntry[size];
        }
      }

      if (specificPack) return specificPack;

      const generic = CASE_PACK_MAP["defaultMain"];
      if (generic && generic.packs[size]) {
        return generic.packs[size];
      }

      return null;
    }

    // -----------------------------
    // 5. ORDER SUMMARY
    // -----------------------------

    function handleQtyChange() {
      if (this.value === "" || Number(this.value) < 0) {
        this.value = "0";
      }
      updateOrderSummary();
    }

    function handleClearAll() {
      const inputs = tableBody.querySelectorAll("input[type='number']");
      inputs.forEach(input => {
        input.value = "0";
      });
      updateOrderSummary();
    }

    function handleCopy() {
      const text = orderTextEl.value.trim();
      if (!text) {
        copyStatusEl.textContent = "Nothing to copy yet.";
        return;
      }
      navigator.clipboard.writeText(text)
        .then(() => {
          copyStatusEl.textContent = "Copied to clipboard.";
          setTimeout(() => {
            copyStatusEl.textContent = "";
          }, 2000);
        })
        .catch(() => {
          copyStatusEl.textContent = "Unable to copy automatically.";
        });
    }

    function updateOrderSummary() {
      const orders = {};
      const styleTotals = {};

      const inputs = tableBody.querySelectorAll("input[data-style-id]");
      inputs.forEach(input => {
        const styleId = input.dataset.styleId;
        const size = input.dataset.sizeCode;
        const qty = parseInt(input.value, 10) || 0;

        if (!styleTotals[styleId]) styleTotals[styleId] = 0;
        styleTotals[styleId] += qty;

        if (qty > 0) {
          if (!orders[styleId]) orders[styleId] = {};
          orders[styleId][size] = qty;
        }
      });

      // Update per-style totals in table
      const rows = tbody.querySelectorAll("tr");
      rows.forEach(row => {
        const styleId = row.dataset.styleId;
        const td = row.querySelector(".style-total");
        const total = styleTotals[styleId] || 0;
        if (td) td.textContent = String(total);
      });

      const totalPairs = Object.keys(styleTotals).reduce(
        (sum, sid) => sum + (styleTotals[sid] || 0),
        0
      );
      totalPairsEl.textContent = String(totalPairs);

      const stylesWithQty = Object.keys(orders).length;
      stylesWithQtyEl.textContent = String(stylesWithQty);

      const parkId = parkSelect.value;
      const parkName = parkId && PARK_MAP[parkId]
        ? PARK_MAP[parkId].name
        : "________";

      const lines = [];
      lines.push("Altitude Socks Order");
      lines.push("--------------------");
      lines.push(`Park: ${parkName}`);
      lines.push("");

      const styleIds = Object.keys(orders);

      styleIds.sort((a, b) => {
        const sa = STYLE_MAP[a]?.name || a;
        const sb = STYLE_MAP[b]?.name || b;
        return sa.localeCompare(sb);
      });

      styleIds.forEach(styleId => {
        const style = STYLE_MAP[styleId];
        const styleName = style ? style.name : styleId;
        lines.push(styleName + ":");

        const sizeEntries = Object.entries(orders[styleId]);
        sizeEntries.sort((a, b) => {
          const ia = SIZE_ORDER.indexOf(a[0]);
          const ib = SIZE_ORDER.indexOf(b[0]);
          return ia - ib;
        });

        const parts = sizeEntries.map(([size, qty]) => {
          const pack = getCasePack(styleId, size);
          if (pack) {
            const cases = Math.ceil(qty / pack);
            return (
              size +
              " x " +
              qty +
              " (" +
              cases +
              " case" +
              (cases > 1 ? "s" : "") +
              " of " +
              pack +
              ")"
            );
          } else {
            return size + " x " + qty;
          }
        });

        lines.push("  " + parts.join(", "));
        lines.push("");
      });

      if (styleIds.length > 0) {
        lines.push("");
      }
      lines.push("Total pairs: " + totalPairs);

      orderTextEl.value = lines.join("\n");
    }

    document.addEventListener("DOMContentLoaded", initApp);
  </script>
</body>
</html>
